name: CI
on: push
    
# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "greet"
  ci:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - name: Install and Build 🔧 # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
        run: |
          cd ..
          ls
          pwd
          ls note-vuepress
          ls -a
          npm install  # 安装依赖
          npm build    # 执行打包
          cd ./note/.vuepress/ # 切换到 dist 目录
          tar -czvf dist.tar dist # 目标文件进行打包
      - name: Deploy 🚀
        uses: cross-the-world/ssh-scp-ssh-pipelines@latest # 因为构建之后，需要把代码上传到服务器上，所以需要连接到ssh，并且做一个安全拷贝(security copy)操作
        env:
          WELCOME: "ssh scp ssh pipelines"
          LASTSSH: "Doing something after copying"
        with:
         host: ${{ secrets.DR_HOST }}
         user: ${{ secrets.DR_USER }}
         pass: ${{ secrets.DR_PASS }}
         port: ${{ secrets.DR_PORT }}
         connect_timeout: 10s
         first_ssh: |
            rm -rf /root/dist
            mkdir -p /root/dist
         scp: |
           './note/.vuepress/dist.tar' => /root
         last_ssh: |
            cd /root # 切换到部署目录
            tar -xzvf dist.tar  # 将 tar 打包文件进行解压到当前部署目录
